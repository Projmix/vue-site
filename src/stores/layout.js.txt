import { ref, computed } from 'vue'
import { defineStore } from 'pinia'

import axios from "axios"
export const useLayoutStore = defineStore("layout", {
    state: () => ({
        layout: null,
        background: `url('/src/assets/images/${window.location.hostname}/ft-bg1.jpg')`,
        logo: `/src/assets/images/${window.location.hostname}/logo1.png`,
        logo2: `/src/assets/images/${window.location.hostname}/logo2.png`
    }),
    getters: {
      getLayout(state){
        return state.layout
      },
      getBackground(state){
        return state.background
      },
      getLogo(state){
        return state.logo
      },
      getLogo2(state){
        return state.logo2
      }
    },
    actions: {
      async fetchLayout() {
        try {
          const apiUrl = `${import.meta.env.VITE_API_URL}/api/v3/pages/layout`;
          const params = {
              lang: import.meta.env.VITE_API_LANG,
              jsonld: import.meta.env.VITE_API_JSONLD,
              onlyDomain: import.meta.env.VITE_API_ONLY_DOMAIN,
              domain: import.meta.env.VITE_API_DOMAIN,
              distributor_company_id: import.meta.env.VITE_API_DISTRIBUTOR_COMPANY_ID,
          };
          const { data } = await axios.get(apiUrl, { params });
          this.layout = data;

          
        } catch (error) {
            console.log(error);
        }
      },

      async loadScript(src) {
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = () => resolve();
          script.onerror = () => reject(new Error(`Ошибка загрузки скрипта: ${src}`));
          document.head.appendChild(script);
        });
      },

      async loadExternalScripts() {
          this.loadScript('/src/assets/js/bs.js')
            .then(() => this.loadScript('/src/assets/js/plugins.js'))
            .then(() => this.loadScript('/src/assets/js/plugins2.js'))
            .then(() => this.loadScript('/src/assets/js/custom.js'))
            .catch(error => console.error("Ошибка загрузки скриптов", error));
      }
    },
})
